# Flutter 商城项目分类页面

## 1 JSON 解析和复杂数据模型转换技巧

**factory 关键字：**当实现构造函数但是不想每次都创建该类的一个实例的时候使用。

**工厂模式**是我们最常用的实例化对象模式了，是用工厂方法代替 new 操作的一种模式。用简单明了的方式解释，模式上类似于面向对象的多态，用起来和静态方法差不多。

model 模型其实就是类。下面是建立数据模型的例子。

```dart
class CategoryBigModel {
  String mallCategoryId; // 类别编号
  String mallCategoryName; // 类别名称
  List<dynamic> bxMallSubDio;
  Null comments;
  String image;

  // 构造方法
  CategoryBigModel({
    this.mallCategoryId,
    this.mallCategoryName,
    this.bxMallSubDio,
    this.comments,
    this.image,
  });

  // 工厂模式的构造方法，其实就是常用的实例化对象的方法
  // 调用fromJson方法的时候不需要new CategoryBigModel()了
  // 相当于JAVA面向对象中的多态，使用方法类似于静态方法
  factory CategoryBigModel.fromJSON(dynamic json) {
    return CategoryBigModel(
      mallCategoryId: json['mallCategoryId'],
      mallCategoryName: json['mallCategoryName'],
      bxMallSubDio: json['bxMallSubDio'],
      comments: json['comments'],
      image: json['image'],
    );
  }
}

class CategoryBigListModel {
  List<CategoryBigModel> data;
  CategoryBigListModel(this.data);

  factory CategoryBigListModel.fromJson(List json) {
    return CategoryBigListModel(
      json.map((i) => CategoryBigModel.fromJSON(i)).toList(),
    );
  }
}
```

- 工作中不需要完全手写，可以使用辅助工具 [json_to_dart](https://javiercbk.github.io/json_to_dart/) 直接把 JSON 转换成 Dart 类，拷贝生成的 Dart 类。

- 在lib 目录下新建文件夹 model，在 model 文件夹下新建文件比如 categoryGoodsList.dart，把拷贝的 Dart 类复制到 categoryGoodsList.dart 文件中，修改里面的默认类名，Autogenerated 改成 CategoryGoodsListModel，Data 改成 CategoryGoodsListData。

- 在页面中使用，通过 model 类把后端返回的 JSON 数据处理成我们方便使用的数据结构（可以像 JS 中一样使用点来访问对象的属性）。

  ```dart
  import '../../model/categoryGoodsList.dart';
  ```

  ```dart
  await request('getMallGoods', data: postData).then((val) {
    var data = json.decode(val.toString());
    CategoryGoodsListModel goodsList = CategoryGoodsListModel.fromJson(data);
    print(goodsList.data[0].goodsName);
  });
  ```

## 2 ListView

可以滚动的横向或者纵向组件，里面有很多小的组件。横向的需要设置宽和高，纵向的可以只设置宽。

```dart
ListView.builder(
  scrollDirection: Axis.horizontal, // 默认是纵向，需要手动改成横向
  itemCount: list.length,
  // 构造器
  itemBuilder: (context, index) {
    return _leftInkWell(index);
  },
)
```

## 3 Container

```dart
InkWell(
  onTap: (){},
  child: Container(
    padding: EdgeInsets.only(top: 5.0, bottom: 5.0),
    decoration: BoxDecoration( // 设置背景颜色和边框
      color: Colors.white,
      border: Border(
        bottom: BorderSide(
          width: 1.0,
          color: Colors.black12,
        ),
      ),
    ),
    child: Row(
      children: <Widget>[
        _goodsImage(index),
        Column(
          children: <Widget>[
            _goodsName(index),
            _goodsPrice(index),
          ],
        ),
      ],
    ),
  ),
)
```

## 4 ListView

```dart
Container(
  width: ScreenUtil().setWidth(570),
  height: ScreenUtil().setHeight(1000),
  child: ListView.builder( // 动态的构造方法的ListView
    itemCount: list.length,
    itemBuilder: (context, index) {
      return _goodsListItem(index);
    },
  ), 
)
```













































