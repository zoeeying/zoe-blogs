# 前端自动化测试

`npx jest --init` 可以把 Jest 的配置暴露出来。

如果想测试 ESModule 代码，需要使用 Babel：

```bash
npm install @babel/core @babel/preset-env --save-dev
```

```json
{
  "presets": [
    ["@babel/preset-env", {
      "targets": {
        // 根据当前Node环境，结合@babel/preset-env对代码进行转换
        "node": "current"
      }
    }]
  ]
}
```

## 测试异步代码

对于异步代码，比如请求一个接口，普通的测试用例写法是无效的，需要特殊处理。

#### (1) 回调类型异步函数

```javascript
export function fetchData(fn) {
  axios.get('http://www.dell-lee.com/react/api/demo.json').then((res) => {
    fn(res.data)
  })
}
```

```javascript
test('test fetchData', (done) => {
  fetchData((data) => {
    expect(data).toEqual({
      success: true,
    })
    done()
  })
})
```

测试回调类型的异步函数使用了 done 函数，如果不使用的话，回调函数中的测试代码是执行不到的，只有调用了 done 函数，才表示该测试用例执行完成了。

#### (2) 返回 Promise 的异步函数

```javascript
export function fetchData() {
  return axios.get('http://www.dell-lee.com/react/api/demo.json')
}
```

```javascript
test('test fetchData', () => {
  return fetchData().then((res) => {
    expect(res.data).toEqual({
      success: true,
    })
  })
})
// 如果请求的接口返回404，测试代码如下
test('test fetchData 404', () => {
  // 如果接口没问题，那么catch中的语句就不会执行，通过expect.assertions(1)来限制后面必须执行一个expect，因为catch中的expect无法执行，因此该测试用例无法通过
  expect.assertions(1) // 如果有catch的话，一定要加上这条
  return fetchData().catch((e) => {
    expect(e.toString().includes('404')).toBe(true)
  })
})
```

对于返回 Promise 的异步函数，还有其它的测试写法：

```javascript
test('test fetchData', () => {
  // 通过resolves能拿到获取到的数据，只要数据中包含{data: {success: true}}，那么测试就会通过
  return expect(fetchData()).resolves.toMatchObject({
    data: {
      success: true,
    },
  })
})

// 测试接口请求失败的情况

```



####  



